---
title: "Predição da profundidade do solum"
author: "Horst"
date: "1 de novembro de 2017"
output:
  bookdown::word_document2:
    reference_docx: ../docs/template.docx
bibliography: biblio.bib
csl: abnt.csl
lang: pt
---

```{r, eval=FALSE, echo=FALSE}
rmarkdown::render('main.Rmd', encoding = 'UTF-8', output_dir = "../docs")
```

```{r, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r defin}
# Carregar os Pacotes
library(magrittr)
library(dplyr)
library(glue)
library(lattice)
library(latticeExtra)
library(georob)
library(sp)
library(mapview)
library(raster)
library(rmarkdown)

# Sistemas de referência de coordenadas (Fonte: http://spatialreference.org/ref/epsg/)
wgs84utm22s <- sp::CRS('+proj=utm +zone=22 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs')
sirgas2000 <- sp::CRS('+proj=longlat +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +no_defs')

# Rampas de cores
col_soil_var <- topo.colors(100)
```

```{r}
#Importar pontos

pontos <- read.csv("D:/Projetos/soil-depth/data/GateadosDados.csv", dec = ".", sep= ";", stringsAsFactors = FALSE)
View(pontos)

```

```{r}
str(dados)
plot(Y ~ X, pontos)
barplot(pontos$PFd)

summary(pontos)
shapiro.test(pontos$PFd)
shapiro.test(pontos$h)
```

```{r}
#Layout
  nf <- layout(matrix(c(1,2),2,1,byrow = TRUE), c(2,1), c(1,2), TRUE)
  
  # Draw the boxplot 
  par(mar=c(0, 5.1, 6, 2.1))
  boxplot(dados$PFd , horizontal=TRUE , xaxt="n", col="grey90" , frame=F)
  box()
  
  #Draw and the histogram 
  par(mar=c(5, 5.1, 0, 2.1))
  
  ##frequencia com linha normal
  ex4 <-hist(dados$PFd, breaks=10, xlab="", col="grey90", cex.axis=1,
          xlim=c(1,10),  ylim=c(0,26),ylab="",main="") 
    xfit<-seq(min(x),max(x), length=50) 
    yfit<-dnorm(xfit,mean=mean(x),sd=sd(x)) 
   yfit<-  yfit*diff(ex4$mids[1:2])*length(x) 
    lines(xfit, yfit, col="red", lwd=2) 
    mtext("Frequência",line=2.6, side=2, cex=1) 
    mtext("PF (dm)",line=2.6, side=1, cex=1) 
    rug(x, col="red")
     box()
     

ex4

```

```{r}
#transformar coord dos pontos
sp :: coordinates(pontos) <- c('X' , 'Y')
sp :: proj4string(pontos) <- wgs84utm22s #coordenada referencia

pontos <- sp :: spTransform(pontos, wgs84utm22s) #transforma coordenada para wgs84

mapview(pontos)
```


```{r}
#Importar shape da área (contorno)
pistola <- 
 raster::shapefile('D:/Projetos/soil-depth/data/contorno/limite_projeto.shp',
                   stringsAsFactors = TRUE, encoding = 'UTF-8') %>%
 sp::spTransform(wgs84utm22s)

mapview(pistola)
```

```{r}
#Importar shape da produtividade do projeto pistola e transformar as coordenadas
#shape no pacote raster pela função shapefile

ProdutividadePistola <- 
 raster::shapefile('D:/Projetos/soil-depth/data/Produtividade/ProdutividadePistola.shp',
                   stringsAsFactors = TRUE, encoding = 'UTF-8') %>%
 sp::spTransform(wgs84utm22s)

sp::spplot(ProdutividadePistola, scales = list(draw = TRUE), main = "Mapa Sítio")

mapview(ProdutividadePistola)
ProdutividadePistola@data
str(ProdutividadePistola)

```

```{r}
#Amostragem

#Criar coluna Sitio no conjunto dados e amostrar o shape ProdutividadePistola nos 102 pontos
pontos$Sitio <- sp::over(x = pontos, y = ProdutividadePistola) %>% unlist()

str(dados)
dados@data

```

```{r}
#localização dos pontos

sp::spplot(
  ProdutividadePistola, scales = list(draw = TRUE),
  main = 'Localização dos pontos') +
  lattice::xyplot(Y ~ X, data = as.data.frame(pontos@coords),
                  pch = 20, col = 'red', lwd = 2, cex = 2) %>%
  latticeExtra::as.layer()
```




###########################################



